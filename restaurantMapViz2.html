<html>
<head>
  <script src="https://d3js.org/d3.v5.js"></script>
</head>
<body>

<p>
  <label for="nRadius"
         style="display: inline-block; width: 240px; text-align: right">
         radius = <span id="nRadius-value"></span>
  </label>
  <input type="range" min="10" max="250" id="nRadius">

</p>
<div id="dataviz_builtWithD3"></div>



<script>

  var mapWidth = 750;
  var mapHeight = 750;
  var radius = 1;

  var projection = d3.geoMercator()
      .center([-122.433701, 37.767683]) // San Francisco, roughly
      .scale(225000)
      .translate([mapWidth / 2, mapHeight / 2])

  var svg = d3.select('body')
      .append('svg')
      .attr('width', mapWidth)
      .attr('height', mapHeight);

  var allgroup=["All", "No Risk", "Low Risk", "Moderate Risk", "High Risk"];

  var dropdownButton=d3.select("#dataviz_builtWithD3")
      .append('select');

  dropdownButton
        .selectAll("myOptions")
          .data(allgroup)
        .enter()
          .append('option')
        .text(function (d) {return d; })
        .attr("value", function (d) { return d; })

  svg.append('image')
      .attr('width', mapWidth)
      .attr('height', mapHeight)
      .attr('xlink:href', 'sf-map.svg');

 var scores = d3.select("#dataviz_builtWithD3")
     .append('svg')
     .append("circle")
     .attr("cx", function(d) { return projection([+d.business_longitude, +d.business_latitude])[0]; })
     .attr("cy", function(d) { return projection([+d.business_longitude, +d.business_latitude])[1]; })
     .attr("fill", "green")
     .attr('r', radius);


 function updateChart(option) {
    scores.csv(option).then(function(data){
        svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("fill", "green")
        .attr("cx", function(d) { return projection([+d.business_longitude, +d.business_latitude])[0]; })
        .attr("cy", function(d) { return projection([+d.business_longitude, +d.business_latitude])[1]; })
        .attr('r', radius);
})
};

  dropdownButton.on("change", function(d){
    var selectedOption = d3.select(this).property("value");

    if (selectedOption == "No Risk"){
      updateChart("no_risk.csv")
    }
    else if (selectedOption == "Low Risk"){
      updateChart("low_risk.csv")
    }
    else if (selectedOption == "Moderate Risk"){
      updateChart("mod_risk.csv")
    }
    else if (selectedOption == "High Risk"){
      updateChart("high_risk.csv")
    }
    else {
      updateChart("restaurant_scores.csv")
    }
  })
//  https://bl.ocks.org/williaster/79aa4dbb3ab17f13732f

  svg.on("click", function() {
    var coords = d3.mouse(this);

    svg.append("circle")
      .attr("fill", "black")
      .attr("cx", coords[0])
      .attr("cy", coords[1])
      .attr('r', 25)
      .style("opacity", .25)
      .attr("class", "poi");
  });


  // when the input range changes update the circle
  d3.select("#nRadius").on("input", function() {
    update(+this.value);
  });

  // Initial starting radius of the circle
  update(25);

  // update the elements
  function update(nRadius) {

    // adjust the text on the range slider
    d3.select("#nRadius-value").text(nRadius);
    d3.select("#nRadius").property("value", nRadius);

    // update the rircle radius
    svg.selectAll('circle.poi')
      .attr("r", nRadius);
  }


</script>




</body>
</html>
